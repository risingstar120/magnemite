<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Magnemite</title>
	<link href="./bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>

<body style="overflow:hidden;">
	<div style="width:100%;height:10vh">
		<img id="loading" style="width:16px;height:16px" src='../img/loading.gif' />
        <button id="back" class="btn btn-default">&#9664;</button>
        <button id="forward" class="btn btn-default">&#9654;</button>
        <button id="issue" class="btn btn-danger">Report Issue</button>
	</div>
	<webview id="webview" nodeintegration style="position:absolute;width:100%;height:90vh;"></webview>
	<script>
        const renderer = require('./renderer');
        const { WEBVIEW_START_PAGE } = require('./server-config');
        renderer.createTemp();

        onload = () => {
            const webview = document.getElementById('webview');
            const loading = document.getElementById('loading');
            const issue = document.getElementById('issue');
            const back = document.getElementById('back');
            const forward = document.getElementById('forward');

            var num = 0;

            webview.addEventListener('did-start-loading', () => {
                loading.style.visibility = 'visible';
            });
            webview.addEventListener('did-stop-loading', () => {
                loading.style.visibility = 'hidden';
            });

            back.addEventListener('click', () => {
                webview.goBack();
            });

            forward.addEventListener('click', () => {
                webview.goForward();
            });

            webview.addEventListener('will-navigate', (e) => {
                renderer.stopRecording();
            });
            webview.addEventListener('did-navigate', (e) => {
                num++;
                renderer.startRecording(num);
            });

            issue.addEventListener('click', () => {
                renderer.doneRecording(() => {
                    alert('Recording saved to disk!');
                });
            });

            webview.addEventListener('dom-ready', () => {
                if (process.env['NODE_ENV'] === 'development') {
                    webview.openDevTools();
                }
                back.disabled = !webview.canGoBack();
                forward.disabled = !webview.canGoForward();
            });

            webview.src = WEBVIEW_START_PAGE;
        }
    </script>
</body>

</html>